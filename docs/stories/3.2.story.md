# Story 3.2: InputManager Implementation

## Status: Draft

## Story

- As a developer
- I want an InputManager system that handles mouse/touch interactions with GPU-rendered elements
- so that I can enable interactive elements in the 2D graphics pipeline including click logging and microphone permission requests

## Acceptance Criteria (ACs)

1. Create InputManager component that integrates with the three-d graphics pipeline
2. Implement mouse/touch event handling for GPU-rendered elements (specifically green square in test_scene)
3. Add console logging when clicking the green square in test_scene
4. Implement microphone permission request functionality triggered by green square click
5. Integrate InputManager with the event dispatcher system for event-driven interactions
6. Ensure input handling works seamlessly with 2D graphics rendering pipeline

## Tasks / Subtasks

- [ ] Create InputManager module structure (AC: 1)
  - [ ] Define InputManager struct with event dispatcher integration
  - [ ] Create input event types (MouseEvent, TouchEvent, etc.)
  - [ ] Integrate with existing event system in events/mod.rs
- [ ] Implement mouse/touch event capture for graphics canvas (AC: 2)
  - [ ] Canvas event listener setup for mouse/touch events
  - [ ] Coordinate transformation from screen space to graphics space
  - [ ] Hit testing for GPU-rendered elements
- [ ] Add click logging functionality (AC: 3)
  - [ ] Detect clicks on green square in test_scene
  - [ ] Log click events to web console
  - [ ] Integrate with existing test_scene rendering
- [ ] Implement microphone permission request (AC: 4)
  - [ ] Trigger getUserMedia permission request on green square click
  - [ ] Handle permission grant/deny responses
  - [ ] Integrate with existing audio processing pipeline
- [ ] Event dispatcher integration (AC: 5)
  - [ ] Create input event types in events module
  - [ ] Publish input events through global dispatcher
  - [ ] Subscribe to relevant events in graphics renderer
- [ ] Testing and validation (AC: 6)
  - [ ] Verify click detection works on green square
  - [ ] Test microphone permission flow
  - [ ] Validate event propagation through dispatcher

## Dev Notes

**Relevant Source Tree Information:**
- Graphics pipeline: `pitch-toy/graphics/` (mod.rs, graphics_renderer.rs, test_scene.rs)
- Event system: `pitch-toy/events/` (mod.rs, audio_events.rs)
- Event dispatcher: `event-dispatcher/src/lib.rs`
- Test scene with green square: `pitch-toy/graphics/test_scene.rs`

**Key Integration Points:**
- The test_scene.rs already renders a green square in debug builds
- Event dispatcher system is fully implemented and ready for input events
- Audio processing pipeline exists and can handle microphone permissions
- Graphics renderer already has three-d context for coordinate transformations

**Technical Requirements:**
- Must work with GPU-rendered elements (no HTML/CSS for user interface)
- Coordinate transformation from canvas pixels to graphics coordinate system
- Event-driven architecture using the existing Event Dispatcher
- Integration with existing microphone permission system from audio processing

### Testing

Dev Note: Story Requires the following tests:

- [ ] Rust Unit Tests: (nextToFile: true), coverage requirement: 80%
- [ ] Integration Tests location: `tests/input_manager/`
- [ ] Manual E2E testing for click interactions and microphone permissions

Manual Test Steps:
- Load application in development mode
- Click on the green square in test_scene
- Verify console log message appears
- Verify microphone permission dialog appears
- Test with different click positions (hit/miss testing)
- Test on both desktop and mobile browsers

## Dev Agent Record

### Agent Model Used: {{Agent Model Name/Version}}

### Debug Log References

[[LLM: (SM Agent) When Drafting Story, leave next prompt in place for dev agent to remove and update]]
[[LLM: (Dev Agent) If the debug is logged to during the current story progress, create a table with the debug log and the specific task section in the debug log - do not repeat all the details in the story]]

### Completion Notes List

[[LLM: (SM Agent) When Drafting Story, leave next prompt in place for dev agent to remove and update - remove this line to the SM]]
[[LLM: (Dev Agent) Anything the SM needs to know that deviated from the story that might impact drafting the next story.]]

### File List

[[LLM: (Dev Agent) List every new file created, or existing file modified in a bullet list.]]

### Change Log

[[LLM: (SM Agent) When Drafting Story, leave next prompt in place for dev agent to remove and update- remove this line to the SM]]
[[LLM: (Dev Agent) Track document versions and changes during development that deviate from story dev start]]

| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |

## QA Results

[[LLM: QA Agent Results]]
# Unified Project Structure
## Real-time Pitch Visualizer

**Version**: 1.0  
**Source**: Technical Architecture Document  
**Purpose**: Define file organization, module structure, and naming conventions

---

## Project Organization

```
project/
├── src/                       # Rust/WASM core
│   ├── lib.rs                 # WASM entry point with wasm_bindgen
│   ├── audio/                 # Audio processing (compiled to WASM)
│   │   ├── mod.rs             # Audio module exports
│   │   ├── engine.rs          # Core audio engine
│   │   ├── pitch_detector.rs  # Pitch detection algorithms
│   │   └── interval_calc.rs   # Musical interval calculations
│   └── utils.rs               # WASM utilities and helpers
├── web/                       # Web frontend
│   ├── index.html             # Main HTML page + enhanced test suite
│   ├── style.css              # Styling (replaced by embedded CSS)
│   ├── app.js                 # Main application controller
│   ├── audio-worklet.js       # AudioWorklet processor
│   └── renderer.js            # WebGL graphics renderer
├── pkg/                       # Generated WASM output (wasm-pack)
├── tests/                     # Test suites
│   └── wasm-integration/      # WASM integration tests
├── docs/                      # Documentation
│   ├── architecture/          # Architecture documentation (sharded)
│   ├── stories/               # User stories for development
│   └── *.md                   # Project documentation
├── Cargo.toml                 # Rust dependencies
├── dev.sh                     # Development server script
├── serve.rb                   # Ruby development server
└── stop.sh                    # Development server stop script
```

## Module Responsibilities

### Rust/WASM Core (`src/`)

**`src/lib.rs`**
- WASM entry point with wasm_bindgen
- Primary exports for JavaScript integration
- Module coordination

**`src/audio/`**
- `mod.rs`: Audio module exports and public API
- `engine.rs`: Core AudioEngine struct and processing logic  
- `pitch_detector.rs`: Pitch detection algorithms (YIN, McLeod)
- `interval_calc.rs`: Musical interval calculations and tuning systems

**`src/utils.rs`**
- WASM utilities and helper functions
- Memory management utilities
- Serialization helpers

### Web Frontend (`web/`)

**`index.html`**
- Main application HTML structure with enhanced test suite
- Professional browser testing interface (Story 1.1)
- TestFramework class for comprehensive WASM validation
- Performance monitoring dashboard with real-time metrics
- Interactive test controls and automation capabilities

**`style.css`**
- Application styling
- Responsive design rules
- Child-friendly UI themes

**`app.js`**
- Main application controller
- WASM module initialization
- Application state management

**`audio-worklet.js`**
- AudioWorklet processor implementation
- Real-time audio processing coordination
- WASM/Web Audio API bridge

**`renderer.js`**
- WebGL graphics renderer
- Canvas-based visualization
- 60 FPS rendering pipeline

## File Naming Conventions

### Rust Files
- Snake case: `pitch_detector.rs`, `interval_calc.rs`
- Module files: `mod.rs` for module exports
- Library entry: `lib.rs` for crate root

### JavaScript Files
- Kebab case: `audio-worklet.js`, `app.js`
- Descriptive names indicating purpose
- Extension-specific: `.js` for modules

### Documentation
- Kebab case: `tech-stack.md`, `project-structure.md`
- Story files: `{epic}.{story}.story.md` format
- Index files: `index.md` for directory overviews

## Generated Directories

### `pkg/` Directory
- Generated by wasm-pack build process
- Contains compiled WASM binaries
- JavaScript bindings and TypeScript definitions
- **Do not edit manually** - regenerated on each build

## Build Outputs

### Development Build
```bash
wasm-pack build --target web --out-dir pkg
```

### Production Build  
```bash
wasm-pack build --target web --release --out-dir pkg
```

Generated files in `pkg/`:
- `*.wasm` - WebAssembly binary
- `*.js` - JavaScript bindings
- `*.d.ts` - TypeScript definitions
- `package.json` - NPM package metadata

## Development Infrastructure

### Development Server (Story 1.1)
**Ruby-based Server**: `serve.rb` - Cross-platform development server
- **Port Management**: Always uses port 8080 with auto-cleanup
- **WASM Support**: Proper MIME types and CORS headers
- **Auto-restart**: Conflict resolution and port cleanup

**Automation Scripts**:
- `dev.sh` - Build WASM + start server (one command development)
- `stop.sh` - Clean server shutdown and port cleanup

**Access**: http://localhost:8080/web/ (consistent development URL)

### Testing Infrastructure
**Browser Test Suite**: Enhanced `web/index.html` with:
- TestFramework class architecture
- Real-time performance monitoring
- Comprehensive WASM validation
- Stress testing capabilities (1000+ iterations)
- Cross-browser compatibility validation 